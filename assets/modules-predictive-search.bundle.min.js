import{f as e,t}from"./shared-import-theme-a11y.bundle.min.js";window.ThemeComponent_PredictiveSearch=s=>({cachedResults:{},loading:!1,resultsOpen:!1,rawQuery:"",results:!1,resultsMarkup:null,resources:s,get trimmedQuery(){return this.rawQuery.trim()},get queryKey(){return this.trimmedQuery.replace(" ","-").toLowerCase()},mounted(){this.cachedResults={};document.querySelectorAll("[data-open-search]").forEach((e=>{e.setAttribute("role","button")})),document.addEventListener("keyup",(e=>{"Escape"===e.key&&this.close(!1)})),this.$watch("searchOpen",(e=>{!0===e&&this.onOpen()}))},close(e=!0){this.closeResults(e),this.closePredictiveSearch()},closePredictiveSearch(){document.body.dispatchEvent(new CustomEvent("shapes:search:closebutton"))},closeResults(e=!1){this.resultsOpen=!1,e&&(this.rawQuery="");const t=this.$root.querySelector('[aria-selected="true"]');t&&t.setAttribute("aria-selected",!1),this.$refs.input.setAttribute("aria-activedescendant",""),this.$refs.input.setAttribute("aria-expanded",!1),document.documentElement.style.overflowY="auto"},getSearchResults(){this.loading=!0,liveRegion(window.theme.strings.loading),fetch(`${window.theme.routes.predictive_search_url}?q=${encodeURIComponent(this.trimmedQuery)}&${encodeURIComponent("resources[type]")}=${this.resources}&section_id=predictive-search`).then((e=>{if(this.loading=!1,!e.ok){var t=new Error(e.status);throw this.close(!0),t}return e.text()})).then((e=>{this.results=!0;const t=(new DOMParser).parseFromString(e,"text/html").querySelector("#shopify-section-predictive-search").innerHTML,s=(new DOMParser).parseFromString(e,"text/html").querySelector("#predictive-search-count").textContent;this.cachedResults[this.queryKey]=t,this.renderSearchResults(t),liveRegion(s)})).catch((e=>{throw this.close(!0),e}))},onChange(){this.trimmedQuery.length?(this.openResults(),this.getSearchResults()):this.closeResults()},onFocus(){this.trimmedQuery.length&&(!0===this.results?this.openResults():this.getSearchResults())},onFocusOut(){this.searchOpen&&setTimeout((()=>{this.$refs.searchFieldComponent.contains(document.activeElement)||e(this.$root)[0].focus()}))},onFormSubmit(e){this.trimmedQuery.length&&!this.$root.querySelector('[aria-selected="true"] a')||e.preventDefault()},onKeyup(e){switch(e.preventDefault(),e.code){case"ArrowUp":this.switchOption("up");break;case"ArrowDown":this.switchOption("down");break;case"Enter":this.selectOption()}},onKeydown(e){"Escape"===e.code&&this.trimmedQuery.length&&e.preventDefault(),"ArrowUp"!==e.code&&"ArrowDown"!==e.code||e.preventDefault()},onOpen(){this.trimmedQuery.length&&(this.openResults(),this.$nextTick((()=>{this.cachedResults[this.queryKey]?this.renderSearchResults(this.cachedResults[this.queryKey]):this.getSearchResults()})))},openResults(){this.resultsOpen=!0,this.$refs.input.setAttribute("aria-expanded",!0),document.documentElement.style.overflowY="hidden"},renderSearchResults(e){this.$refs.results.innerHTML=e,this.results=!0,this.openResults(),setTimeout((()=>{t(this.$root),this.$refs.input.focus()}),300)},selectOption(){const e=this.$root.querySelector('[aria-selected="true"] a, [aria-selected="true"] button');e&&e.click()},switchOption(e){if(!this.resultsOpen)return;const t="up"===e,s=this.$root.querySelector('[aria-selected="true"]'),r=Array.from(this.$root.querySelectorAll(".predictive-search__option"));let i=this.$root.querySelector(".predictive-search__option");t&&!r.length||(!t&&s?i=r[r.indexOf(s)+1]||r[0]:t&&(i=r[r.indexOf(s)-1]||r[r.length-1]),i!==s&&(i.setAttribute("aria-selected",!0),s&&s.setAttribute("aria-selected",!1),this.$refs.input.setAttribute("aria-activedescendant",i.id),i.scrollIntoView(!1,{behavior:"smooth"})))}});
